
	DATA 	EQU 0X21
	CONT1	EQU	0X22
	CONT2	EQU	0X23
    DE1     EQU 0X24
    DE2     EQU 0X25
    DE3     EQU 0X26

    ;BEGIN
	ORG	0X00
	GOTO	START

;CODE
START
    ;BANK 1
    BSF     STATUS, 5
    BCF     STATUS, 6

	CLRF	TRISB 		; PORT B ALL OUTPUT - LEDS
	CLRF	TRISC		; PORT C ALL OUTPUT - DISPLAY 1
	CLRF	TRISD		; PORT D ALL OUTPUT - DISPLAY 2
	BSF		TRISC, 7	; SELECTOR PART 1
	BSF		TRISD, 7	; EMITTER RECEIVER SIGNAL DETECTOR

    ;BANK 0
    BCF     STATUS, 5
    BCF     STATUS, 6

    ;INIT BOTH DISPLAYS TO 9
	MOVLW	B'01111100'
	MOVWF	PORTC
	MOVWF	PORTD

    ;INIT CONTS
    MOVLW   0X09
    MOVWF   CONT1
    MOVWF   CONT2

	GOTO	MAIN

MAIN
	BTFSC	PORTC, 7
	CALL	RIGHT
	BTFSS	PORTC, 7
	CALL	LEFT
	GOTO	MAIN

LEFT
	MOVLW	B'11111110'
	CALL	MV
	MOVLW	B'11111101'
	CALL	MV
	MOVLW	B'11111011'
	CALL	MV
	MOVLW	B'11110111'
	CALL	MV
	MOVLW	B'11101111'
	CALL	MV
	MOVLW	B'11011111'
	CALL	MV
	MOVLW	B'10111111'
	CALL	MV
	MOVLW	B'01111111'
	CALL	MV
	RETURN

RIGHT
	MOVLW	B'01111111'
	CALL	MV
	MOVLW	B'10111111'
	CALL	MV
	MOVLW	B'11011111'
	CALL	MV
	MOVLW	B'11101111'
	CALL	MV
	MOVLW	B'11110111'
	CALL	MV
	MOVLW	B'11111011'
	CALL	MV
	MOVLW	B'11111101'
	CALL	MV
	MOVLW	B'11111110'
	CALL	MV
	RETURN

MV
    ;MOVE LITERAL TO LEDS IN PORTB
	MOVWF	DATA
	MOVF	DATA, W
	MOVWF	PORTB

    ;DELAY
	MOVLW	0x1F
	MOVWF	DE1
	MOVLW	0xFF
	MOVWF	DE2
	MOVWF	DE3
	CALL	DELAY

    ;EMITTER TRANSMITTER
	CALL	SIGNAL

	RETURN

;DELAY OF 31x255x255
DELAY
	DECFSZ	DE1, 0X01
	GOTO DELAY2
	RETURN

DELAY2
	DECFSZ	DE2, 0X01
	GOTO DELAY3
    MOVLW   0XFF
    MOVWF   DE2
	GOTO DELAY

DELAY3
    DECFSZ  DE3, 0X01
    GOTO    DELAY3
    MOVLW   0XFF
    MOVWF   DE3
    GOTO DELAY2

;DISPLAY 1 == DISPLAY 2
;C0:PIN 15 -- D0:PIN 19 -> DISPLAY 1:E
;C1:PIN 16 -- D1:PIN 20 -> DISPLAY 2:D
;C2:PIN 17 -- D2:PIN 21 -> DISPLAY 4:C
;C3:PIN 18 -- D3:PIN 22 -> DISPLAY 6:B
;C4:PIN 23 -- D4:PIN 27 -> DISPLAY 7:A
;C5:PIN 24 -- D5:PIN 28 -> DISPLAY 9:F
;C6:PIN 25 -- D6:PIN 29 -> DISPLAY 10:G
SIGNAL
    ;RETURN IF NO INTERRUPTION
	BTFSC	PORTD, 7
	RETURN

	MOVF	CONT2, W
	XORLW	0X00
	BTFSC	STATUS, 2
	GOTO	CHECKCONT1

    CALL    DISPLAYNUM2
	RETURN

CHECKCONT1
	MOVF	CONT1, W
	XORLW	0X00
	BTFSS	STATUS, 2
    CALL    RESETCONT2
	MOVF	CONT1, W
	XORLW	0X00
    BTFSC   STATUS, 2
    CALL    RESETALL
    RETURN

RESETCONT2
    CALL    DISPLAYNUM1

    MOVLW   0X09
    MOVWF   CONT2

	;9 ON DISPLAY 2
	MOVLW	B'01111100'
	MOVWF	PORTD

    RETURN

RESETALL
	MOVF	CONT2, W
	XORLW	0X00
    BTFSS   STATUS, 2
    RETURN

	;RESET CONTS
    MOVLW   0X09
    MOVWF   CONT1
    MOVWF   CONT2

	;9 ON BOTH DISPLAYS
	MOVLW	B'01111100'
	MOVWF	PORTC
	MOVWF	PORTD
	RETURN

;DISPLAY NUM ON TENS DISPLAY
DISPLAYNUM1
    DECF    CONT1, 0X01

    MOVFW   CONT1
    MOVWF   DATA
    CALL    GETNUM
    MOVWF   PORTC

    RETURN

;DISPLAY NUM ON UNITS DISPLAY
DISPLAYNUM2
	DECF	CONT2, 0X01

    MOVFW   CONT2
    MOVWF   DATA
    CALL    GETNUM
    MOVWF   PORTD

    RETURN

GETNUM

	MOVF	DATA, W
	XORLW	0X00
	BTFSC	STATUS, 2
	GOTO	ZERO

	MOVF	DATA, W
	XORLW	0X01
	BTFSC	STATUS, 2
	GOTO	ONE

	MOVF	DATA, W
	XORLW	0X02
	BTFSC	STATUS, 2
	GOTO	TWO

	MOVF	DATA, W
	XORLW	0X03
	BTFSC	STATUS, 2
	GOTO	THREE

	MOVF	DATA, W
	XORLW	0X04
	BTFSC	STATUS, 2
	GOTO	FOUR

	MOVF	DATA, W
	XORLW	0X05
	BTFSC	STATUS, 2
	GOTO	FIVE

	MOVF	DATA, W
	XORLW	0X06
	BTFSC	STATUS, 2
	GOTO	SIX

	MOVF	DATA, W
	XORLW	0X07
	BTFSC	STATUS, 2
	GOTO	SEVEN

	MOVF	DATA, W
	XORLW	0X08
	BTFSC	STATUS, 2
	GOTO	EIGHT

	MOVF	DATA, W
	XORLW	0X09
	BTFSC	STATUS, 2
	GOTO	NINE


;== DISPLAY PATTERNS ==
ZERO
	MOVLW	B'00111111'
    RETURN
ONE
	MOVLW	B'00001100'
	RETURN

TWO
	MOVLW	B'01011011'
	RETURN

THREE
	MOVLW	B'01011110'
	RETURN

FOUR
	MOVLW	B'01101100'
	RETURN

FIVE
	MOVLW	B'01110110'
	RETURN

SIX
	MOVLW	B'01110111'
	RETURN

SEVEN
	MOVLW	B'00011100'
	RETURN

EIGHT
	MOVLW	B'01111111'
	RETURN

NINE
	MOVLW	B'01111100'
	RETURN

END
